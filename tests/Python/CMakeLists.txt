
if(ENABLE_PYTHON)
  find_package(PythonInterp REQUIRED)

  function(create_Python_test name cwd)
    if(${PYTHON_VERSION_MAJOR} STREQUAL "2")
      add_test(${name} COMMAND nosetests --exe -A "Eigen==False" WORKING_DIRECTORY ${cwd})
      if(EIGEN_FOUND)
        add_test(${name}_Eigen COMMAND nosetests --exe -A "Eigen==True" WORKING_DIRECTORY ${cwd})
      endif(EIGEN_FOUND)
    else(${PYTHON_VERSION_MAJOR} STREQUAL "2")
      find_program(NOSETESTS3 NAMES nosetests3 HINTS /usr/bin) #for Ubuntu...
      if(NOSETESTS3)
        add_test(${name} COMMAND nosetests3 --exe -A "Eigen==False" WORKING_DIRECTORY ${cwd})
        if(EIGEN_FOUND)
          add_test(${name}_Eigen COMMAND nosetests3 --exe -A "Eigen==True" WORKING_DIRECTORY ${cwd})
        endif(EIGEN_FOUND)
      else(NOSETESTS3)
        add_test(${name} COMMAND nosetests --exe -A "Eigen==False" WORKING_DIRECTORY ${cwd})
        if(EIGEN_FOUND)
          add_test(${name}_Eigen COMMAND nosetests --exe -A "Eigen==True" WORKING_DIRECTORY ${cwd})
        endif(EIGEN_FOUND)
      endif(NOSETESTS3)
    endif(${PYTHON_VERSION_MAJOR} STREQUAL "2")
  endfunction(create_Python_test)

  file(GLOB entries *)
  foreach(entry ${entries})
    if(IS_DIRECTORY ${entry} AND EXISTS ${entry}/CMakeLists.txt)
      add_subdirectory(${entry})
    endif()
  endforeach(entry)

endif(ENABLE_PYTHON)
